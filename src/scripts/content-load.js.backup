/* =====================================================
   CONTENT LOAD - FLORAMAZONIA
   Carrega os componentes HTML dinamicamente
   ===================================================== */

// Configuracao dos componentes a serem carregados
const components = [
    {
        id: 'header-placeholder',
        path: './src/components/common/Header/Header.html',
        name: 'Header'
    },
    {
        id: 'hero-placeholder',
        path: './src/components/sections/Hero/Hero.html',
        name: 'Hero'
    },
    {
        id: 'sobre-placeholder',
        path: './src/components/sections/Sobre/Sobre.html',
        name: 'Sobre'
    },
    {
        id: 'beneficios-placeholder',
        path: './src/components/sections/Beneficios/Beneficios.html',
        name: 'Benefícios'
    },
    {
        id: 'produtos-placeholder',
        path: './src/components/sections/Produtos/Produtos.html',
        name: 'Produtos'
    },
    {
        id: 'depoimentos-placeholder',
        path: './src/components/sections/Depoimentos/Depoimentos.html',
        name: 'Depoimentos'
    },
    {
        id: 'faq-placeholder',
        path: './src/components/sections/FAQ/FAQ.html',
        name: 'FAQ'
    },
    {
        id: 'cta-placeholder',
        path: './src/components/sections/CTA/CTA.html',
        name: 'CTA'
    },
    {
        id: 'footer-placeholder',
        path: './src/components/sections/Footer/Footer.html',
        name: 'Footer'
    },
    {
        id: 'whatsapp-placeholder',
        path: './src/components/common/WhatsAppButton/WhatsAppButton.html',
        name: 'WhatsApp'
    }
];

/**
 * Carrega um componente HTML em um elemento placeholder
 * @param {string} elementId - ID do elemento placeholder
 * @param {string} filePath - Caminho do arquivo HTML
 * @param {string} componentName - Nome do componente para log
 */
async function loadComponent(elementId, filePath, componentName) {
    try {
        const element = document.getElementById(elementId);
        if (!element) {
            console.warn(`⚠️ Placeholder '${elementId}' não encontrado para ${componentName}`);
            return false;
        }

        const response = await fetch(filePath);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const html = await response.text();
        element.outerHTML = html;
        
        console.log(`✅ ${componentName} carregado com sucesso`);
        return true;
    } catch (error) {
        console.error(`❌ Erro ao carregar ${componentName}:`, error.message);
        return false;
    }
}

/**
 * Carrega todos os componentes configurados
 */
async function loadAllComponents() {
    console.log('🚀 Iniciando carregamento de componentes...');
    
    try {
        // Carrega todos os componentes em paralelo
        const results = await Promise.allSettled(
            components.map(component => 
                loadComponent(component.id, component.path, component.name)
            )
        );
        
        // Conta sucessos e falhas
        const successful = results.filter(r => r.status === 'fulfilled' && r.value).length;
        const total = components.length;
        
        console.log(`📦 Carregamento concluído: ${successful}/${total} componentes`);
        
        // Dispara evento customizado quando todos os componentes estiverem carregados
        document.dispatchEvent(new CustomEvent('componentsLoaded', {
            detail: { successful, total }
        }));
        
    } catch (error) {
        console.error('❌ Erro crítico no carregamento:', error);
    }
}

// Inicia o carregamento quando o DOM estiver pronto
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadAllComponents);
} else {
    // DOM já carregado
    loadAllComponents();
}
